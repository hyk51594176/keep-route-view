"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var Core=function(){function e(){_classCallCheck(this,e),this.contextMap=new Map,this.includeList=new Set,this.unWatch=null,this.router=null,this.direction=null,this.stateKey=null}return _createClass(e,[{key:"bindVm",value:function(e){if(!this.router){if(!e.parent.$router)throw new Error("请在使用该组件前安装vueRouter");this.router=e.parent.$router,window.addEventListener("popstate",this.directionChange.bind(this,"back")),this.init()}this.contextMap.has(e.parent)||(this.contextMap.set(e.parent,e),e.parent.$on("hook:beforeDestroy",this.unBindVm.bind(this,e)))}},{key:"init",value:function(){var r=this;["push","replace","back","forward","go"].forEach(function(t){var n=r.router[t].bind(r.router);r.router[t]=function(){var e=t;"go"===t&&(arguments.length<=0?void 0:arguments[0])<0&&(e="back"),r.directionChange(e),n.apply(void 0,arguments)}}),this.unWatch=this.router.afterEach(function(e,t){"back"===r.direction||"replace"===r.direction?t.matched.forEach(function(e){var t=e.components.default.name;r.includeList.has(t)&&r.includeList.delete(t)}):e.matched.forEach(function(e){var t=e.components.default;!t.name||t.noKeep||r.includeList.has(t.name)||r.includeList.add(t.name)}),r.includeChange()})}},{key:"unBindVm",value:function(e){this.contextMap.delete(e),0===this.contextMap.size&&(this.unWatch(),this.router=null,this.direction="",window.removeEventListener("popstate",this.updateDirection.bind(this)))}},{key:"directionChange",value:function(t,e){this.direction=t,e&&e.state.key&&(this.stateKey&&(this.direction=e.stateKey<this.stateKey?"back":"forward"),this.stateKey=e.stateKey),this.contextMap.forEach(function(e){e.listeners.change&&e.listeners.change(t)})}},{key:"includeChange",value:function(){var t=this;this.contextMap.forEach(function(e){e.listeners.includeChange&&e.listeners.includeChange([].concat(_toConsumableArray(e.props.include||[]),_toConsumableArray(t.includeList)))})}}]),e}(),core=new Core;function styleInject(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}var css="\n.pop-in-enter-active,\n.pop-in-leave-active,\n.pop-out-enter-active,\n.pop-out-leave-active {\n    position: fixed;\n    top: 0px;\n    width: 100%;\n    height: 100%;\n    background: #fbf9fe;\n    transition-duration: 300ms;\n    transition-timing-function: cubic-bezier(0.4, 0.6, 0.2, 1);\n    -webkit-transition-property: opacity, -webkit-transform;\n    transition-property: opacity, transform;\n    \n}\n.pop-out-enter {\n    transform: translate3d(-33%, 0, 0);\n    opacity: 1;\n    z-index: 1;\n}\n\n.pop-out-enter-to {\n    transform: translate3d(0, 0, 0);\n    opacity: 1;\n    z-index: 1;\n}\n\n.pop-out-leave {\n    transform: translate3d(0, 0, 0);\n    opacity: 1;\n    z-index: 2;\n}\n\n.pop-out-leave-to {\n    transform: translate3d(100%, 0, 0);\n    opacity: 1;\n    z-index: 2;\n}\n\n.pop-in-enter {\n    transform: translate3d(100%, 0, 0);\n    opacity: 1;\n    z-index: 2;\n}\n\n.pop-in-enter-to {\n    transform: translate3d(0, 0, 0);\n    opacity: 1;\n    z-index: 2;\n}\n\n.pop-in-leave {\n    transform: translate3d(0, 0, 0);\n    opacity: 0.8;\n    z-index: 1;\n}\n\n.pop-in-leave-to {\n    transform: translate3d(-33%, 0, 0);\n    opacity: 0;\n    z-index: 1;\n}\n\n.pop-out-leave-active\n.pop-in-enter-active {\n    box-shadow: -5px 0 3px rgba(0, 0, 0, .15);\n}";styleInject(css);var KeepRouteView={functional:!0,name:"KeepRouteView",props:{include:[String,Array,RegExp],exclude:[String,Array,RegExp],max:{type:Number,default:10},transition:Boolean,transitionOptions:{type:Object,default:function(){return{}}}},render:function(e,t){var n=t.props,r=n.include,i=n.transition,o=n.transitionOptions;core.bindVm(t);var a=[].concat(_toConsumableArray(core.includeList),_toConsumableArray(r||[])),s=e("keep-alive",{props:_objectSpread({},t.props,{include:a})},[e("router-view",t.data,t.children)]);return i?e("transition",{props:_objectSpread({name:"back"===core.direction?"pop-out":"pop-in"},o||{}),on:t.listeners},[s]):s}};function install(e){install.Installed||(e.component(KeepRouteView.name,KeepRouteView),install.Installed=!0)}module.exports=install;
