"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}function _defineProperty(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function _objectSpread(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.forEach(function(e){_defineProperty(n,e,t[e])})}return n}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var Core=function(){function e(){_classCallCheck(this,e),this.contextMap=new Map,this.includeList=new Set,this.unWatch=null,this.router=null,this.direction=null}return _createClass(e,[{key:"bindVm",value:function(e){if(!this.router){if(!e.parent.$router)throw new Error("请在使用该组件前安装vueRouter");this.router=e.parent.$router,window.addEventListener("popstate",this.directionChange.bind(this,"back")),this.init()}this.contextMap.has(e.parent)||(this.contextMap.set(e.parent,e),e.parent.$on("hook:beforeDestroy",this.unBindVm.bind(this,e)))}},{key:"init",value:function(){var t=this;["push","replace","back"].forEach(function(e){var n=t.router[e].bind(t.router);t.router[e]=function(){t.directionChange(e),n.apply(void 0,arguments)}}),this.unWatch=this.router.afterEach(function(e,n){"back"===t.direction||"replace"===t.direction?n.matched.forEach(function(e){var n=e.components.default.name;t.includeList.has(n)&&t.includeList.delete(n)}):e.matched.forEach(function(e){var n=e.components.default;!n.name||n.noKeep||t.includeList.has(n.name)||t.includeList.add(n.name)}),t.includeChange()})}},{key:"unBindVm",value:function(e){this.contextMap.delete(e),0===this.contextMap.size&&(this.unWatch(),this.router=null,this.direction="",window.removeEventListener("popstate",this.updateDirection.bind(this)))}},{key:"directionChange",value:function(n){this.direction=n,this.contextMap.forEach(function(e){e.listeners.change&&e.listeners.change(n)})}},{key:"includeChange",value:function(){var n=this;this.contextMap.forEach(function(e){e.listeners.includeChange&&e.listeners.includeChange([].concat(_toConsumableArray(e.props.include||[]),_toConsumableArray(n.includeList)))})}}]),e}(),core=new Core;function styleInject(e,n){void 0===n&&(n={});var t=n.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===t&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}var css="\n.pop-in-enter-active,\n.pop-in-leave-active,\n.pop-out-enter-active,\n.pop-out-leave-active {\n    position: fixed;\n    top: 0px;\n    width: 100%;\n    height: 100%;\n    background: #fbf9fe;\n    transition-duration: 300ms;\n    transition-timing-function: cubic-bezier(0.4, 0.6, 0.2, 1);\n    -webkit-transition-property: opacity, -webkit-transform;\n    transition-property: opacity, transform;\n    \n}\n.pop-out-enter {\n    transform: translate3d(-33%, 0, 0);\n    opacity: 1;\n    z-index: 1;\n}\n\n.pop-out-enter-to {\n    transform: translate3d(0, 0, 0);\n    opacity: 1;\n    z-index: 1;\n}\n\n.pop-out-leave {\n    transform: translate3d(0, 0, 0);\n    opacity: 1;\n    z-index: 2;\n}\n\n.pop-out-leave-to {\n    transform: translate3d(100%, 0, 0);\n    opacity: 1;\n    z-index: 2;\n}\n\n.pop-in-enter {\n    transform: translate3d(100%, 0, 0);\n    opacity: 1;\n    z-index: 2;\n}\n\n.pop-in-enter-to {\n    transform: translate3d(0, 0, 0);\n    opacity: 1;\n    z-index: 2;\n}\n\n.pop-in-leave {\n    transform: translate3d(0, 0, 0);\n    opacity: 0.8;\n    z-index: 1;\n}\n\n.pop-in-leave-to {\n    transform: translate3d(-33%, 0, 0);\n    opacity: 0;\n    z-index: 1;\n}\n\n.pop-out-leave-active\n.pop-in-enter-active {\n    box-shadow: -5px 0 3px rgba(0, 0, 0, .15);\n}";styleInject(css);var KeepRouteView={functional:!0,name:"KeepRouteView",props:{include:[String,Array,RegExp],exclude:[String,Array,RegExp],max:{type:Number,default:10},transition:Boolean,transitionOptions:{type:Object,default:function(){return{}}}},render:function(e,n){var t=n.props,r=t.include,i=t.transition,o=t.transitionOptions;core.bindVm(n);var a=[].concat(_toConsumableArray(core.includeList),_toConsumableArray(r||[])),c=e("keep-alive",{props:_objectSpread({},n.props,{include:a})},[e("router-view",n.data,n.children)]);return i?e("transition",{props:_objectSpread({name:"back"===core.direction?"pop-out":"pop-in"},o||{}),on:n.listeners},[c]):c}};function install(e){install.Installed||(e.component(KeepRouteView.name,KeepRouteView),install.Installed=!0)}module.exports=install;
