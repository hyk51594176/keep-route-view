"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}function _defineProperty(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function _objectSpread(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.forEach(function(e){_defineProperty(n,e,t[e])})}return n}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var Core=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"bindVm",value:function(e){if(!t.router){if(!e.parent.$router)throw new Error("请在使用该组件前安装vueRouter");t.router=e.parent.$router,window.addEventListener("popstate",t.directionChange.bind(t,"back")),t.init()}t.contextMap.has(e.parent)||(t.contextMap.set(e.parent,e),e.parent.$on("hook:beforeDestroy",t.unBindVm.bind(t,e)))}},{key:"init",value:function(){["push","replace","back"].forEach(function(e){var n=t.router[e].bind(t.router);t.router[e]=function(){t.directionChange(e),n.apply(void 0,arguments)}}),t.unWatch=t.router.afterEach(function(e,n){"back"===t.direction||"replace"===t.direction?n.matched.forEach(function(e){var n=e.components.default.name;t.includeList.has(n)&&t.includeList.delete(n)}):e.matched.forEach(function(e){var n=e.components.default;!n.name||n.noKeep||t.includeList.has(n.name)||t.includeList.add(n.name)}),t.includeChange()})}},{key:"unBindVm",value:function(e){t.contextMap.delete(e),0===t.contextMap.size&&(t.unWatch(),t.router=null,t.direction="",window.removeEventListener("popstate",t.updateDirection.bind(t)))}},{key:"directionChange",value:function(n){t.direction=n,t.contextMap.forEach(function(e){e.listeners.change&&e.listeners.change(n)})}},{key:"includeChange",value:function(){t.contextMap.forEach(function(e){e.listeners.includeChange&&e.listeners.includeChange([].concat(_toConsumableArray(e.props.include||[]),_toConsumableArray(t.includeList)))})}}]),t}();_defineProperty(Core,"contextMap",new Map),_defineProperty(Core,"includeList",new Set),_defineProperty(Core,"unWatch",null),_defineProperty(Core,"router",null);var KeepRouteView={functional:!0,name:"KeepRouteView",props:{include:[String,Array,RegExp],exclude:[String,Array,RegExp],max:{type:Number,default:10}},render:function(e,n){Core.bindVm(n);var t=[].concat(_toConsumableArray(Core.includeList),_toConsumableArray(n.props.include||[]));return e("keep-alive",{props:_objectSpread({},n.props,{include:t})},[e("router-view",n.data,n.children)])}};function install(e){install.Installed||(e.component(KeepRouteView.name,KeepRouteView),install.Installed=!0)}module.exports=install;
