"use strict";var Core=function(){function t(){this.vmList=[],this.direction="",this.routes=[],this.unWatch=null}var e=t.prototype;return e.bindVm=function(t){return this.vmList.length?this.vmList.push(t):(this.vmList.push(t),window.addEventListener("popstate",this.updateDirection.bind(this)),this.init(t)),this.unBindVm.bind(this,this.vmList.length-1)},e.init=function(i){var n=this;["push","replace","back"].forEach(function(t){var e=i.$router[t].bind(i.$router);i.$router[t]=function(){n.direction=t,n.setVmData("direction"),e.apply(void 0,arguments)}}),this.unWatch=i.$router.afterEach(function(t,e){"back"===n.direction||"replace"===n.direction?e.matched.forEach(function(t){var e=n.routes.lastIndexOf(t.components.default.name);-1<e&&n.routes.splice(e,1)}):t.matched.forEach(function(t){var e=t.components.default;e.name&&!e.noKeep&&n.routes.indexOf(e.name)<0&&n.routes.push(e.name)}),n.setVmData("routes")})},e.unBindVm=function(t){this.vmList.splice(t,1),this.vmList.length||(this.unWatch(),window.removeEventListener("popstate",this.updateDirection.bind(this)))},e.updateDirection=function(){this.direction="back",this.setVmData("direction")},e.setVmData=function(e){var i=this;this.vmList.forEach(function(t){t[e]=i[e]})},t}(),core=new Core,KeepRouteView={name:"KeepRouteView",props:{include:[String,Array,RegExp],exclude:[String,Array,RegExp],max:{type:Number,default:10},name:[String]},data:function(){return{direction:"",routes:[]}},watch:{direction:function(t){this.$emit("change",t)}},created:function(){if(!this.$router)throw new Error("请在使用该组件前安装vueRouter");var t=core.bindVm(this);this.$once("hook:beforeDestroy",t)},computed:{defaultInclude:function(){return this.include?this.routes.concat(this.include):this.routes}},render:function(t){return t("keep-alive",{props:{include:this.defaultInclude,exclude:this.exclude,max:this.max}},[t("router-view",{props:{name:this.name}})].concat(this.$slots.default||[]))}};function install(t){install.Installed||(t.component(KeepRouteView.name,KeepRouteView),install.Installed=!0)}module.exports=install;
